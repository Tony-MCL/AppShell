/* src/styles/tablecore.css */

/* ==== [BLOCK: TableCore CSS] BEGIN ==== */

:root {
  --tc-bg:         var(--mcl-table-bg, #ffffff);
  --tc-fg:         var(--mcl-text, #151515);
  --tc-grid:       var(--mcl-outline, #e8dfd5);
  --tc-accent:     var(--mcl-accent, #b08968);

  /* Selection base (hex) + alpha */
  --tc-sel:        var(--mcl-table-select, #f2e6dc);
  --tc-sel-border: var(--mcl-table-select-border, var(--mcl-accent, #b08968));
  --tc-sel-alpha:  0.5;

  --tc-edit-bg:    #fffdf7;
}

/* Basis-layout */
.tc-root {
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
  color: var(--tc-fg);
  height: 100%;
  display: flex;
  flex-direction: column;

  --tc-font-size: 14px;
  --tc-row-h: 28px;

  /* ‚úÖ Header split (sum ~ 57px) */
  --tc-header-info-h: 22px;
  --tc-header-cols-h: 35px;
}

.tc-wrap {
  border: 1px solid var(--tc-grid);
  border-radius: 0;
  background: var(--tc-bg);
  height: 100%;
  overflow-x: auto;
  overflow-y: auto;
}

/* ‚úÖ KLER P√Ö "NAKEN"-AREAL:
   Gridcontainerne skal aldri bli smalere enn viewport,
   men kan v√¶re bredere enn viewport n√•r tabellen er bred. */
.tc-header-stack,
.tc-header-info,
.tc-header,
.tc-row,
.tc-summary {
  width: max-content;
  min-width: 100%;
}

/* =========================================================
   ‚úÖ STICKY HEADER-STACK (tittel + kolonner)
   - Sticky p√• Y-scroll
   - F√∏lger X-scroll fordi den er del av scrolled content
   ========================================================= */
.tc-header-stack {
  position: sticky;
  top: 0;
  z-index: 25; /* over rader/selection */
  background: var(--mcl-table-header, #d7c2a8);
}

/* ===== Header stack: 2 niv√•er (ikke sticky hver for seg) ===== */

.tc-header-info {
  display: grid;
  border-bottom: 1px solid var(--tc-grid);
  user-select: none;
  background: transparent; /* bakgrunn eies av stacken */
  position: relative;
  z-index: 0;
}

.tc-header-info .tc-cell {
  min-height: var(--tc-header-info-h);
  display: flex;
  align-items: center;
  padding-top: 2px;
  padding-bottom: 2px;
}

.tc-header-info-cell {
  font-weight: 600;
  opacity: 0.92;
}

.tc-header-info-text {
  display: inline-block;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.tc-header {
  display: grid;
  border-bottom: 1px solid var(--tc-grid);
  user-select: none;
  background: transparent; /* bakgrunn eies av stacken */
  position: relative;
  z-index: 0;
}

/* kolonneheader-h√∏yde */
.tc-header .tc-cell {
  min-height: var(--tc-header-cols-h);
  display: flex;
  align-items: center;
  padding-top: 6px;
  padding-bottom: 6px;
}

.tc-header .tc-cell { font-weight: 600; }
.tc-header .tc-idx { font-weight: 400; }

/* ===== Rows ===== */

.tc-row {
  display: grid;
  border-bottom: 1px solid var(--tc-grid);
  background: var(--tc-bg);
  position: relative;
  overflow: visible;
}

.tc-cell {
  padding: 6px 8px;
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
  cursor: default;
  font-size: var(--tc-font-size);
  min-height: var(--tc-row-h);

  /* Viktig for selection-borders */
  position: relative;
}

.tc-idx {
  color: #7a7a85;
  text-align: right;
  padding-right: 6px;
}

.tc-title {
  display: flex;
  align-items: center;
  gap: 6px;
}

.tc-indent {
  display: inline-block;
  width: calc(var(--lvl) * 14px);
}

.tc-summary {
  background: var(--mcl-table-summary, #f3eadf);
  font-weight: 600;
  border-bottom: 1px solid var(--tc-grid);
}

/* Inputs */
.tc-cell input,
.tc-cell textarea {
  width: 100%;
  padding: 0;
  margin: 0;
  border: none;
  outline: none;
  background: transparent;
  font: inherit;
  color: inherit;
  font-weight: inherit;
  font-style: inherit;
  text-transform: inherit;
  line-height: inherit;
  letter-spacing: inherit;
}

/* ‚úÖ Reset appearance p√• alt, MEN IKKE native date-input */
.tc-cell input:not(.tc-date-native),
.tc-cell textarea {
  -webkit-appearance: none;
  appearance: none;
}

/* L√•s textarea */
.tc-cell textarea {
  resize: none !important;
  height: 22px;
  max-height: 22px;
  overflow: hidden;
}

/* Editing */
.tc-cell.editing {
  background: transparent !important;
  outline: 1px solid #000;
  outline-offset: 0;
  z-index: 2;
}
.tc-cell.editing.sel {
  background: transparent !important;
}

/* Selection fill:
   Alpha p√• bakgrunn (ikke opacity p√• hele cella) */
.tc-cell.sel {
  background-color: color-mix(in srgb, var(--tc-sel) calc(var(--tc-sel-alpha) * 100%), transparent);
  z-index: 1;
}

/* Fallback hvis color-mix ikke st√∏ttes */
@supports not (background-color: color-mix(in srgb, #000 50%, transparent)) {
  .tc-cell.sel {
    background: var(--tc-sel);
  }
}

/* Selection border (robust, basert p√• sel-top/left/right/right/bottom) */
.tc-cell.sel-top::before,
.tc-cell.sel-bottom::before,
.tc-cell.sel-left::after,
.tc-cell.sel-right::after {
  content: "";
  position: absolute;
  pointer-events: none;
  z-index: 3;
  background: var(--tc-sel-border);
  opacity: 1;
}

.tc-cell.sel-top::before {
  top: -1px;
  left: -1px;
  right: -1px;
  height: 2px;
}

.tc-cell.sel-bottom::before {
  bottom: -1px;
  left: -1px;
  right: -1px;
  height: 2px;
}

.tc-cell.sel-left::after {
  left: -1px;
  top: -1px;
  bottom: -1px;
  width: 2px;
}

.tc-cell.sel-right::after {
  right: -1px;
  top: -1px;
  bottom: -1px;
  width: 2px;
}

/* Sl√• av text selection ved drag */
.tc-root.tc-noselect,
.tc-root.tc-noselect * {
  user-select: none !important;
}

/* Parent/Child styling */
.tc-row.tc-parent {
  background: var(--tc-bg);
}
.tc-row.tc-parent .tc-cell {
  font-weight: 700;
  text-transform: uppercase;
}

.tc-row.tc-child {
  background: var(--mcl-table-child, var(--tc-bg));
}
.tc-row.tc-child .tc-cell {
  font-style: italic;
}

/* Hover deaktivert */
.tc-row:not(.tc-summary):hover .tc-cell:not(.sel) {
  background: transparent !important;
}

/* Disclosure button */
.tc-disc {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 18px;
  height: 18px;
  margin-right: 4px;
  border: none;
  background: transparent;
  padding: 0;
  cursor: pointer;
  font-size: 12px;
  line-height: 1;
  color: inherit;
}
.tc-disc:focus {
  outline: 1px dashed #bbb;
  outline-offset: 2px;
}

/* DnD styling */
.tc-header-cell { cursor: grab; position: relative; }
.tc-header-cell:active { cursor: grabbing; }
.tc-row-handle { cursor: grab; }
.tc-row-handle:active { cursor: grabbing; }

/* Row drop hint */
.tc-row.tc-drop-before::before,
.tc-row.tc-drop-after::after {
  content: "";
  position: absolute;
  left: -1px;
  right: -1px;
  height: 3px;
  background: #1e66ff;
  pointer-events: none;
  z-index: 999;
  opacity: 0.95;
}
.tc-row.tc-drop-before::before { top: -2px; }
.tc-row.tc-drop-after::after { bottom: -2px; }

/* Vertical grid lines */
.tc-header-info > .tc-cell + .tc-cell,
.tc-header > .tc-cell + .tc-cell,
.tc-row > .tc-cell + .tc-cell,
.tc-summary > .tc-cell + .tc-cell {
  border-left: 1px solid var(--tc-grid);
}

/* Column resize handle */
.tc-header-label { pointer-events: none; }

.tc-col-resizer {
  position: absolute;
  top: 0;
  right: -6px;     /* ‚úÖ st√∏rre treffomr√•de uten √• endre layout */
  width: 12px;     /* ‚úÖ fra 6px -> 12px */
  height: 100%;
  cursor: col-resize;
  z-index: 5;
}

/* hover-linje midtstilt i hit-area */
.tc-col-resizer:hover::after {
  content: "";
  position: absolute;
  top: 0;
  bottom: 0;
  left: 50%;
  width: 1px;
  transform: translateX(-50%);
  background: var(--tc-grid);
}

/* ==== [BLOCK: Date button inside cell] ===================== */

.tc-edit-wrap {
  position: relative;
  width: 100%;
  height: 100%;
}

/* gi plass til knappen p√• h√∏yre side i editoren */
.tc-cell--has-datebtn textarea {
  padding-right: 30px;
}

/* kalenderknapp (bare visuell) */
.tc-date-btn {
  position: absolute;
  top: 50%;
  right: 6px;
  transform: translateY(-50%);
  width: 22px;
  height: 22px;
  border: 1px solid var(--tc-grid);
  background: var(--tc-bg);
  border-radius: 6px;
  font-size: 12px;
  line-height: 1;
  display: inline-flex;
  align-items: center;
  justify-content: center;

  /* üëá Viktig: klikk skal g√• til input som ligger over */
  pointer-events: none;
}

/* Native date input ligger usynlig OPP√Ö knappen.
   Klikk p√• ikonet == klikk p√• input => Edge √•pner picker stabilt. */
.tc-date-native {
  -webkit-appearance: auto;
  appearance: auto;

  position: absolute;
  top: 50%;
  right: 6px;
  transform: translateY(-50%);

  width: 22px;
  height: 22px;

  opacity: 0;
  cursor: pointer;
  pointer-events: auto;

  /* holder den ‚Äúaktiv‚Äù i layout uten √• vises */
  border: 0;
  background: transparent;
}

/* ============================================================
   PROGRESS / HIERARCHY VISUALS (B)
   - Pure visuals only (no semantics)
============================================================ */

.tc-row.tc-parent {
  font-weight: 600;
}

.tc-row.tc-parent .tc-title-text {
  font-weight: 800;
  text-transform: uppercase;
}

.tc-row.tc-child .tc-title-text {
  font-style: italic;
}

/* Subtle row differentiation */
.tc-row.tc-parent {
  background: rgba(0, 0, 0, 0.02);
}

.tc-row.tc-child {
  background: rgba(0, 0, 0, 0.01);
}

/* Indent ‚Äúguide‚Äù feel in title cell */
.tc-disc {
  width: 14px;
  height: 14px;
  margin-right: 2px;

  /* ‚úÖ viktig: flytt trekanten inn i padding/innrykk,
     s√• parent-tekst ikke blir mer innrykket enn child */
  margin-left: -16px;

  font-size: 10px;
  line-height: 1;
  opacity: 0.85;
}

.tc-row.tc-child .tc-title-text::before {
  content: "";
  position: absolute;
  left: 0;
  top: 4px;
  bottom: 4px;
  width: 2px;
  background: rgba(0, 0, 0, 0.08);
  border-radius: 2px;
  transform: translateX(-10px);
}

/* Optional: a little more breathing room in rows */
.tc-cell {
  line-height: 1.2;
}

/* ==== [BLOCK: TableCore CSS] END ==== */
